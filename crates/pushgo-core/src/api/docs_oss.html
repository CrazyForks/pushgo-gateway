<!doctype html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PushGo Gateway API</title>
    <style>
      :root {
        color-scheme: light;
        --bg: #f7f7f4;
        --panel: #ffffff;
        --text: #1b1b1b;
        --muted: #5f5f5f;
        --accent: #0b6bcb;
        --border: #e2e2de;
        --code-bg: #0f172a;
        --code-text: #e2e8f0;
      }
      body {
        margin: 0;
        font-family:
          "IBM Plex Sans", "Noto Sans SC", "PingFang SC", "Hiragino Sans GB",
          "Microsoft YaHei", sans-serif;
        color: var(--text);
        background: var(--bg);
      }
      main {
        max-width: 980px;
        margin: 36px auto 80px;
        padding: 0 20px;
      }
      header {
        background: linear-gradient(135deg, #fef3c7 0%, #e0f2fe 100%);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 28px;
        margin-bottom: 24px;
      }
      h1 {
        margin: 0 0 8px;
        font-size: 28px;
      }
      h2 {
        margin-top: 28px;
        font-size: 22px;
      }
      h3 {
        margin-top: 20px;
        font-size: 18px;
      }
      p {
        color: var(--muted);
        line-height: 1.6;
      }
      section {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 20px 22px;
        margin-top: 18px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
        font-size: 14px;
      }
      th,
      td {
        border-bottom: 1px solid var(--border);
        text-align: left;
        padding: 10px 8px;
        vertical-align: top;
      }
      th {
        color: var(--muted);
        font-weight: 600;
      }
      code,
      pre {
        font-family:
          "IBM Plex Mono", "JetBrains Mono", "SFMono-Regular", "Menlo",
          monospace;
      }
      pre {
        background: var(--code-bg);
        color: var(--code-text);
        padding: 14px;
        border-radius: 12px;
        overflow-x: auto;
      }
      .badge {
        display: inline-block;
        background: #eef6ff;
        color: #0b6bcb;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 12px;
        margin-left: 8px;
      }
      .note {
        background: #fff7ed;
        border: 1px solid #fed7aa;
        padding: 10px 12px;
        border-radius: 10px;
        color: #7c2d12;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <main>
      <header>
        <h1>PushGo Gateway API</h1>
        <p>
          此页面为 PushGo 网关的核心 API 文档。当前仅展示
          <strong>/push</strong> 推送接口。
          <br />
          This page documents the core PushGo Gateway APIs. It currently shows
          only the <strong>/push</strong> endpoint.
        </p>
      </header>

      <section>
        <h2>推送接口<br />Push API</h2>
        <p>
          <strong>POST</strong> <code>/push</code>
          <span class="badge">JSON</span>
        </p>
        <p>
          该接口只做校验并接收推送请求，发送在后台异步完成，不会阻塞等待
          APNs/FCM 返回。
          <br />
          This endpoint validates and accepts push requests; delivery is
          asynchronous and does not wait for APNs/FCM responses.
        </p>

        <h3>请求头<br />Request headers</h3>
        <table>
          <thead>
            <tr>
              <th>请求头<br />Header</th>
              <th>必填<br />Required</th>
              <th>说明<br />Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>Content-Type: application/json</code></td>
              <td>是<br />Yes</td>
              <td>请求体为 JSON。<br />Body must be JSON.</td>
            </tr>
            <tr>
              <td><code>Authorization: Bearer &lt;token&gt;</code></td>
              <td>可选<br />Optional</td>
              <td>如果网关配置了认证令牌，则必须携带。<br />Required when a Token is configured.</td>
            </tr>
          </tbody>
        </table>

        <h3>请求体字段<br />Request body fields</h3>
        <table>
          <thead>
            <tr>
              <th>字段<br />Field</th>
              <th>必填<br />Required</th>
              <th>类型<br />Type</th>
              <th>说明<br />Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>channel_id</code></td>
              <td>是<br />Yes</td>
              <td>string</td>
              <td>频道 ID，由创建/订阅频道接口返回。<br />Channel ID returned by create/subscribe.</td>
            </tr>
            <tr>
              <td><code>password</code></td>
              <td>是<br />Yes</td>
              <td>string</td>
              <td>频道密码，长度 8-128。<br />Channel password, 8-128 chars.</td>
            </tr>
            <tr>
              <td><code>title</code></td>
              <td>是<br />Yes</td>
              <td>string</td>
              <td>通知标题，不能为空。<br />Notification title, cannot be empty.</td>
            </tr>
            <tr>
              <td><code>body</code></td>
              <td>否<br />No</td>
              <td>string</td>
              <td>通知正文，可为空。客户端可自动识别 Markdown。<br />Body text, optional. Clients auto-detect Markdown.</td>
            </tr>
            <tr>
              <td><code>icon</code></td>
              <td>否<br />No</td>
              <td>string</td>
              <td>
                通知 icon 的 URL，在 iOS 通知中心使用，建议使用 png/jpeg/gif，大小建议小于 10KB。
                <br />
                Icon URL used in iOS Notification Center; use png/jpeg/gif, size under 10 KB.
              </td>
            </tr>
            <tr>
              <td><code>image</code></td>
              <td>否<br />No</td>
              <td>string</td>
              <td>
                图片 URL，在通知中同步渲染，建议使用 png/jpeg/gif，大小建议小于 1MB。
                <br />
                Image URL rendered in notifications; use png/jpeg/gif, size under 1 MB.
              </td>
            </tr>
            <tr>
              <td><code>sound</code></td>
              <td>否<br />No</td>
              <td>string</td>
              <td>
                提示音名称。默认使用 <code>default</code>，建议填写客户端已识别的音频文件名。
                <br />
                Sound name. Defaults to <code>default</code>; use a client-recognized file name.
              </td>
            </tr>
            <tr>
              <td><code>level</code></td>
              <td>否<br />No</td>
              <td>string</td>
              <td>
                通知级别。<code>critical</code> 会提升优先级并触发关键通知，其它值视为普通。
                <br />
                Notification level. <code>critical</code> raises priority and triggers critical alerts; other values are normal.
              </td>
            </tr>
            <tr>
              <td><code>volume</code></td>
              <td>否<br />No</td>
              <td>number</td>
              <td>
                关键通知音量（0.0 - 1.0）。仅在 <code>level=critical</code> 时生效。
                <br />
                Critical alert volume (0.0 - 1.0). Only effective when <code>level=critical</code>.
              </td>
            </tr>
          </tbody>
        </table>

        <h3>示例请求<br />Example request</h3>
        <pre>
{
  "channel_id": "01HZX9G7G7JPRV4M3H5T9B3C6A",
  "password": "my-channel-password",
  "title": "PushGo 通知标题",
  "body": "## 这是一条 Markdown 通知\n- 任务 A\n- 任务 B",
  "level": "critical",
  "volume": 0.7,
  "sound": "default"
}</pre
        >

        <h3>返回字段<br />Response fields</h3>
        <table>
          <thead>
            <tr>
              <th>字段<br />Field</th>
              <th>类型<br />Type</th>
              <th>说明<br />Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>channel_id</code></td>
              <td>string</td>
              <td>规范化后的频道 ID。<br />Normalized channel ID.</td>
            </tr>
            <tr>
              <td><code>channel_name</code></td>
              <td>string</td>
              <td>频道名称。<br />Channel name.</td>
            </tr>
            <tr>
              <td><code>message_id</code></td>
              <td>string</td>
              <td>此次推送请求的消息 ID。<br />Message ID for this push request.</td>
            </tr>
            <tr>
              <td><code>total</code></td>
              <td>number</td>
              <td>目标设备总数。<br />Total target devices.</td>
            </tr>
            <tr>
              <td><code>accepted</code></td>
              <td>number</td>
              <td>被网关接受并进入发送队列的设备数。<br />Accepted devices queued for delivery.</td>
            </tr>
            <tr>
              <td><code>rejected</code></td>
              <td>number</td>
              <td>被拒绝的设备数（通常是瞬时负载导致）。<br />Rejected devices (usually due to load).</td>
            </tr>
          </tbody>
        </table>

        <h3>示例响应<br />Example response</h3>
        <pre>
{
  "success": true,
  "data": {
    "channel_id": "01HZX9G7G7JPRV4M3H5T9B3C6A",
    "channel_name": "我的频道",
    "message_id": "1f5f81b5-2d11-4b6e-9e7c-3b0d1b5bd8c8",
    "total": 42,
    "accepted": 42,
    "rejected": 0
  }
}</pre
        >
      </section>

      <section>
        <h2>Markdown 支持说明<br />Markdown support</h2>
        <p>
          PushGo 客户端会基于 <code>body</code> 内容自动识别 Markdown
          并进行渲染，不需要额外字段。
          <br />
          PushGo clients auto-detect Markdown in <code>body</code> and render it
          without extra fields.
        </p>
        <h3>支持的块级标签<br />Block-level elements</h3>
        <ul>
          <li>段落（普通文本行）<br />Paragraphs (plain text lines)</li>
          <li>标题：<code>#</code> ~ <code>######</code><br />Headings: <code>#</code> ~ <code>######</code></li>
          <li>
            分割线：<code>---</code> / <code>***</code> / <code>___</code>
            <br />
            Horizontal rules: <code>---</code> / <code>***</code> / <code>___</code>
          </li>
          <li>无序列表（单层）：<code>-</code> 或 <code>*</code><br />Unordered list (single level): <code>-</code> or <code>*</code></li>
          <li>有序列表（单层）：<code>1.</code><br />Ordered list (single level): <code>1.</code></li>
          <li>引用：<code>&gt;</code><br />Blockquote: <code>&gt;</code></li>
          <li>
            Callout：<code>[!info]</code> / <code>[!success]</code> /
            <code>[!warning]</code> / <code>[!error]</code>
            <br />
            Callouts: <code>[!info]</code> / <code>[!success]</code> /
            <code>[!warning]</code> / <code>[!error]</code>
          </li>
          <li>极简表格：<code>| A | B |</code>（最多 3 列、10 行）<br />Simple tables: <code>| A | B |</code> (max 3 columns, 10 rows)</li>
        </ul>

        <h3>支持的行内标签<br />Inline elements</h3>
        <ul>
          <li>粗体：<code>**bold**</code><br />Bold: <code>**bold**</code></li>
          <li>斜体：<code>*italic*</code><br />Italic: <code>*italic*</code></li>
          <li>删除线：<code>~~strikethrough~~</code><br />Strikethrough: <code>~~strikethrough~~</code></li>
          <li>高亮：<code>==highlight==</code><br />Highlight: <code>==highlight==</code></li>
          <li>行内代码：<code>`inline code`</code><br />Inline code: <code>`inline code`</code></li>
          <li>链接：<code>[title](https://example.com)</code><br />Links: <code>[title](https://example.com)</code></li>
          <li>提及：<code>@mention</code><br />Mentions: <code>@mention</code></li>
          <li>标签：<code>#tag</code><br />Tags: <code>#tag</code></li>
          <li>自动识别 URL / 邮箱 / 电话<br />Auto-detect URLs / emails / phone numbers</li>
        </ul>

        <h3>场景示例：微信消息转发<br />Scenario example: WeChat message forwarding</h3>
        <p>
          示例为中文内容，结构同样适用于英文内容。
          <br />
          The sample is in Chinese; the structure applies to English as well.
        </p>
        <pre>
# 微信消息转发
> 来源：@alice 在 #渠道运营
**标题：** 新品上线通知
*时间：* 2025-03-21 09:30

[!info] 已将原消息转发到企业微信，请确认是否需要补充说明。

- 重点：==首批库存 2,000== 件
- 文档：查看 [发布说明](https://example.com/release)
- 备注：~~延后发布~~ 改为今天 10:00
1. 负责人：@bob
2. 联系：ops@example.com / 400-800-1234

| 字段 | 值 | 说明 |
| --- | --- | --- |
| 原始群 | 产品内测群 | WeChat |
| 消息 ID | WX-98231 | `msg_id` |
| 链接 | https://wechat.example.com/msg/98231 | 自动识别 |

---

这个消息包含 `inline code` 和 #转发 标签。</pre
        >

        <h3>场景示例：服务器监控报警<br />Scenario example: server alert</h3>
        <p>
          示例为中文内容，结构同样适用于英文内容。
          <br />
          The sample is in Chinese; the structure applies to English as well.
        </p>
        <pre>
# 服务器监控报警
[!warning] CPU 持续 5 分钟 &gt; 92%，请立即处理。
> 机器：`prod-api-03` (10.2.0.23)
> 时间窗：2025-03-21 10:05-10:10

**影响面：** *支付* 与 *结算* 服务
- 负载：==7.8==
- 错误率：3.2%
- 关联工单：#incident-20250321

1. 检查近期发布：`v2.18.4`
2. 查看日志：https://grafana.example.com/d/abc
3. 值班人：@oncall

| 指标 | 当前 | 阈值 |
| --- | --- | --- |
| CPU | 92% | 85% |
| Memory | 78% | 80% |
| P95 延迟 | 680ms | 500ms |

---

需要升级到 [Runbook](https://example.com/runbook) 或发邮件 ops@example.com。</pre
        >

        <h3>推荐限制<br />Recommended limits</h3>
        <ul>
          <li>
            建议正文 Markdown 控制在 4000 字以内，超长内容可能降级为纯文本。
            <br />
            Keep Markdown bodies within 4,000 characters; longer content may fall back to plain text.
          </li>
          <li>列表内容较长时建议控制在 2400 字以内，以保证渲染性能。<br />Keep long lists within 2,400 characters to preserve rendering performance.</li>
        </ul>
      </section>

      <section>
        <h2>错误与限制<br />Errors and limits</h2>
        <ul>
          <li>参数校验失败返回 400。<br />Validation failures return 400.</li>
          <li>认证失败返回 401。<br />Authentication failures return 401.</li>
          <li>频道不存在返回 404。<br />Missing channels return 404.</li>
          <li>
            网关会输出访问日志（包含脱敏请求/响应），但不会持久化消息内容。
            <br />
            The gateway prints access logs (with redacted request/response) but does not persist message content.
          </li>
        </ul>
      </section>
    </main>
  </body>
</html>
